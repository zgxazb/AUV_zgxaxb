<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="1200" height="1000" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
  <!-- 背景和标题 -->
  <rect width="1200" height="1000" fill="#f9f9f9"/>
  <text x="600" y="40" font-size="24" font-weight="bold" text-anchor="middle" fill="#333">AUV流体力学与控制系统详细流程图</text>
  <text x="600" y="70" font-size="14" text-anchor="middle" fill="#666">基于牛顿-欧拉方程的流体动力学仿真</text>
  
  <!-- 左侧：控制输入层 -->
  <rect x="50" y="100" width="250" height="80" rx="8" fill="#f6ffed" stroke="#52c41a" stroke-width="3"/>
  <text x="175" y="145" font-size="16" font-weight="bold" text-anchor="middle" fill="#52c41a">控制输入层</text>
  
  <!-- 键盘控制 -->
  <rect x="70" y="200" width="210" height="60" rx="5" fill="#fff1f0" stroke="#eb2f96" stroke-width="2"/>
  <text x="175" y="235" font-size="14" font-weight="bold" text-anchor="middle" fill="#eb2f96">键盘控制输入</text>
  
  <!-- PID控制器 -->
  <rect x="70" y="280" width="210" height="60" rx="5" fill="#fff1f0" stroke="#eb2f96" stroke-width="2"/>
  <text x="175" y="315" font-size="14" font-weight="bold" text-anchor="middle" fill="#eb2f96">PID控制器</text>
  
  <!-- 控制参数设置 -->
  <rect x="70" y="360" width="210" height="60" rx="5" fill="#fff1f0" stroke="#eb2f96" stroke-width="2"/>
  <text x="175" y="395" font-size="14" font-weight="bold" text-anchor="middle" fill="#eb2f96">控制参数设置</text>
  
  <!-- 连接控制输入层 -->
  <line x1="175" y="180" x2="175" y="200" stroke="#52c41a" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="175" y="260" x2="175" y="280" stroke="#52c41a" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="175" y="340" x2="175" y="360" stroke="#52c41a" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 中间：动力学与流体力学层 -->
  <rect x="350" y="100" width="350" height="80" rx="8" fill="#e6f7ff" stroke="#1890ff" stroke-width="3"/>
  <text x="525" y="145" font-size="16" font-weight="bold" text-anchor="middle" fill="#1890ff">动力学与流体力学层</text>
  
  <!-- 推进器模型 -->
  <rect x="370" y="200" width="150" height="60" rx="5" fill="#fff2e8" stroke="#fa8c16" stroke-width="2"/>
  <text x="445" y="235" font-size="14" font-weight="bold" text-anchor="middle" fill="#fa8c16">推进器模型</text>
  <text x="445" y="250" font-size="11" text-anchor="middle" fill="#fa8c16">F = propeller_thrust</text>
  
  <!-- 舵机模型 -->
  <rect x="540" y="200" width="150" height="60" rx="5" fill="#fff2e8" stroke="#fa8c16" stroke-width="2"/>
  <text x="615" y="235" font-size="14" font-weight="bold" text-anchor="middle" fill="#fa8c16">舵机模型</text>
  <text x="615" y="250" font-size="11" text-anchor="middle" fill="#fa8c16">F = effectiveness × angle</text>
  
  <!-- 流体阻力计算 -->
  <rect x="370" y="280" width="320" height="70" rx="5" fill="#f0f5ff" stroke="#2f54eb" stroke-width="2"/>
  <text x="530" y="315" font-size="14" font-weight="bold" text-anchor="middle" fill="#2f54eb">流体阻力计算</text>
  <text x="530" y="335" font-size="11" text-anchor="middle" fill="#2f54eb">线性阻力: F = -C_lin × v</text>
  <text x="530" y="350" font-size="11" text-anchor="middle" fill="#2f54eb">角阻力: τ = -C_ang × ω</text>
  
  <!-- 力与力矩合成 -->
  <rect x="370" y="370" width="320" height="70" rx="5" fill="#f0f5ff" stroke="#2f54eb" stroke-width="2"/>
  <text x="530" y="405" font-size="14" font-weight="bold" text-anchor="middle" fill="#2f54eb">力与力矩合成</text>
  <text x="530" y="425" font-size="11" text-anchor="middle" fill="#2f54eb">总力: F_total = F_prop + F_rudders + F_drag</text>
  <text x="530" y="440" font-size="11" text-anchor="middle" fill="#2f54eb">总力矩: τ_total = τ_prop + τ_rudders + τ_drag</text>
  
  <!-- 运动学方程 -->
  <rect x="370" y="460" width="320" height="80" rx="5" fill="#f0f5ff" stroke="#2f54eb" stroke-width="2"/>
  <text x="530" y="505" font-size="14" font-weight="bold" text-anchor="middle" fill="#2f54eb">运动学方程</text>
  <text x="530" y="525" font-size="11" text-anchor="middle" fill="#2f54eb">加速度: a = F_total / m</text>
  <text x="530" y="540" font-size="11" text-anchor="middle" fill="#2f54eb">角加速度: α = I⁻¹ × τ_total</text>
  
  <!-- 坐标系转换 -->
  <rect x="370" y="560" width="150" height="60" rx="5" fill="#fff2e8" stroke="#fa8c16" stroke-width="2"/>
  <text x="445" y="595" font-size="14" font-weight="bold" text-anchor="middle" fill="#fa8c16">坐标系转换</text>
  <text x="445" y="610" font-size="11" text-anchor="middle" fill="#fa8c16">旋转矩阵</text>
  
  <!-- 状态更新 -->
  <rect x="540" y="560" width="150" height="60" rx="5" fill="#fff2e8" stroke="#fa8c16" stroke-width="2"/>
  <text x="615" y="595" font-size="14" font-weight="bold" text-anchor="middle" fill="#fa8c16">状态更新</text>
  <text x="615" y="610" font-size="11" text-anchor="middle" fill="#fa8c16">位置、姿态、速度</text>
  
  <!-- 连接动力学层 -->
  <line x1="525" y="180" x2="525" y="200" stroke="#1890ff" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="445" y="260" x2="530" y="280" stroke="#1890ff" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="615" y="260" x2="530" y="280" stroke="#1890ff" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="530" y="350" x2="530" y="370" stroke="#1890ff" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="530" y="450" x2="530" y="460" stroke="#1890ff" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="530" y="540" x2="445" y="560" stroke="#1890ff" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="530" y="540" x2="615" y="560" stroke="#1890ff" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 右侧：状态与可视化层 -->
  <rect x="750" y="100" width="350" height="80" rx="8" fill="#f0f5ff" stroke="#2f54eb" stroke-width="3"/>
  <text x="925" y="145" font-size="16" font-weight="bold" text-anchor="middle" fill="#2f54eb">状态与可视化层</text>
  
  <!-- 状态向量 -->
  <rect x="770" y="200" width="310" height="60" rx="5" fill="#fafafa" stroke="#8c8c8c" stroke-width="2"/>
  <text x="925" y="235" font-size="14" font-weight="bold" text-anchor="middle" fill="#8c8c8c">状态向量</text>
  <text x="925" y="250" font-size="11" text-anchor="middle" fill="#8c8c8c">[x,y,z,φ,θ,ψ,u,v,w,p,q,r]</text>
  
  <!-- 3D可视化 -->
  <rect x="770" y="280" width="310" height="60" rx="5" fill="#fafafa" stroke="#8c8c8c" stroke-width="2"/>
  <text x="925" y="315" font-size="14" font-weight="bold" text-anchor="middle" fill="#8c8c8c">3D可视化界面</text>
  <text x="925" y="330" font-size="11" text-anchor="middle" fill="#8c8c8c">OpenGL渲染</text>
  
  <!-- 状态监测 -->
  <rect x="770" y="360" width="310" height="60" rx="5" fill="#fafafa" stroke="#8c8c8c" stroke-width="2"/>
  <text x="925" y="395" font-size="14" font-weight="bold" text-anchor="middle" fill="#8c8c8c">状态监测与记录</text>
  <text x="925" y="410" font-size="11" text-anchor="middle" fill="#8c8c8c">实时数据显示</text>
  
  <!-- 连接状态与可视化层 -->
  <line x1="925" y="180" x2="925" y="200" stroke="#2f54eb" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="925" y="260" x2="925" y="280" stroke="#2f54eb" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="925" y="340" x2="925" y="360" stroke="#2f54eb" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 层间连接 -->
  <line x1="250" y="235" x2="370" y="235" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="250" y="315" x2="370" y="315" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="250" y="395" x2="370" y="395" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="720" y="235" x2="770" y="235" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="720" y="315" x2="770" y="315" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="720" y="395" x2="770" y="395" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 反馈回路 -->
  <line x1="925" y="420" x2="925" y="460" stroke="#666" stroke-width="2"/>
  <line x1="925" y="460" x2="175" y="460" stroke="#666" stroke-width="2"/>
  <line x1="175" y="460" x2="175" y="420" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="550" y="475" font-size="12" text-anchor="middle" fill="#666">状态反馈</text>
  
  <!-- 流体力学详细计算 -->
  <rect x="150" y="640" width="450" height="80" rx="8" fill="#e6f7ff" stroke="#1890ff" stroke-width="3"/>
  <text x="375" y="685" font-size="16" font-weight="bold" text-anchor="middle" fill="#1890ff">流体力学详细计算</text>
  
  <!-- 线性阻力 -->
  <rect x="170" y="740" width="130" height="50" rx="5" fill="#fff2e8" stroke="#fa8c16" stroke-width="2"/>
  <text x="235" y="765" font-size="13" text-anchor="middle" fill="#fa8c16">线性阻力</text>
  <text x="235" y="780" font-size="10" text-anchor="middle" fill="#fa8c16">F_drag_lin = -C_d · v</text>
  
  <!-- 角阻力 -->
  <rect x="320" y="740" width="130" height="50" rx="5" fill="#fff2e8" stroke="#fa8c16" stroke-width="2"/>
  <text x="385" y="765" font-size="13" text-anchor="middle" fill="#fa8c16">角阻力</text>
  <text x="385" y="780" font-size="10" text-anchor="middle" fill="#fa8c16">τ_drag_ang = -C_τ · ω</text>
  
  <!-- 舵机升力 -->
  <rect x="470" y="740" width="130" height="50" rx="5" fill="#fff2e8" stroke="#fa8c16" stroke-width="2"/>
  <text x="535" y="765" font-size="13" text-anchor="middle" fill="#fa8c16">舵机升力</text>
  <text x="535" y="780" font-size="10" text-anchor="middle" fill="#fa8c16">F_rudder = K_r · θ_r</text>
  
  <!-- 推进器推力 -->
  <rect x="320" y="810" width="130" height="50" rx="5" fill="#fff2e8" stroke="#fa8c16" stroke-width="2"/>
  <text x="385" y="835" font-size="13" text-anchor="middle" fill="#fa8c16">推进器推力</text>
  <text x="385" y="850" font-size="10" text-anchor="middle" fill="#fa8c16">F_prop = propeller_thrust</text>
  
  <!-- 连接流体力学计算 -->
  <line x1="375" y="720" x2="375" y="740" stroke="#1890ff" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="235" y="790" x2="235" y="810" stroke="#1890ff" stroke-width="2"/>
  <line x1="235" y="810" x2="320" y="810" stroke="#1890ff" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="385" y="790" x2="385" y="810" stroke="#1890ff" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="535" y="790" x2="535" y="810" stroke="#1890ff" stroke-width="2"/>
  <line x1="535" y="810" x2="450" y="810" stroke="#1890ff" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 数学公式 -->
  <rect x="650" y="640" width="450" height="220" rx="8" fill="#fff2e8" stroke="#fa8c16" stroke-width="3"/>
  <text x="875" y="685" font-size="16" font-weight="bold" text-anchor="middle" fill="#fa8c16">核心数学公式</text>
  
  <!-- 牛顿-欧拉方程 -->
  <text x="875" y="720" font-size="13" font-weight="bold" text-anchor="middle" fill="#fa8c16">牛顿-欧拉方程</text>
  <text x="875" y="745" font-size="12" text-anchor="middle" fill="#fa8c16">m(ẍ - yẏ² - zẏ²) = F_x</text>
  <text x="875" y="765" font-size="12" text-anchor="middle" fill="#fa8c16">m(ÿ + xẏ² - zẍ²) = F_y</text>
  <text x="875" y="785" font-size="12" text-anchor="middle" fill="#fa8c16">m(ẓ + xẏ² + yẍ²) = F_z</text>
  
  <!-- 力矩方程 -->
  <text x="875" y="810" font-size="13" font-weight="bold" text-anchor="middle" fill="#fa8c16">力矩方程</text>
  <text x="875" y="835" font-size="12" text-anchor="middle" fill="#fa8c16">I_xẍ - (I_y - I_z)qr = τ_x</text>
  <text x="875" y="855" font-size="12" text-anchor="middle" fill="#fa8c16">I_yÿ - (I_z - I_x)pr = τ_y</text>
  <text x="875" y="875" font-size="12" text-anchor="middle" fill="#fa8c16">I_zż - (I_x - I_y)pq = τ_z</text>
  
  <!-- 箭头定义 -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>
  
  <!-- 图例 -->
  <rect x="50" y="880" width="200" height="80" rx="5" fill="#fff" stroke="#d9d9d9" stroke-width="2"/>
  <text x="150" y="900" font-size="12" font-weight="bold" text-anchor="middle" fill="#666">图例</text>
  <text x="150" y="920" font-size="10" text-anchor="middle" fill="#666">控制输入层 → 绿色</text>
  <text x="150" y="940" font-size="10" text-anchor="middle" fill="#666">动力学层 → 蓝色</text>
  <text x="150" y="960" font-size="10" text-anchor="middle" fill="#666">状态层 → 紫色</text>
</svg>